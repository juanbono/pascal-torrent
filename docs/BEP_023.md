# BEP 23: Tracker Returns Compact Peer Lists

**BEP:** 23  
**Title:** Tracker Returns Compact Peer Lists  
**Author:** Greg Hazel  
**Status:** Accepted  
**Type:** Standards Track  
**Created:** 2008

---

## Abstract

To reduce the size of tracker responses and to reduce memory and computational requirements in trackers, trackers may return peers as a packed string rather than as a bencoded list.

---

## Motivation

### Original Format Overhead

Each peer in the original format requires:
- `peer_id`: 20 bytes + 3 bytes bencoding
- `ip`: Up to 255 bytes (domain name) + 4 bytes bencoding
- `port`: Up to 7 bytes including bencoding

**Maximum per peer: ~289 bytes**

### Compact Format

Each peer requires exactly **6 bytes**:
- 4 bytes: IPv4 address (network byte order)
- 2 bytes: Port (network byte order)

---

## Protocol

### Client Request

Clients may include `compact=1` in the announce URL:

```
GET /announce?peer_id=...&info_hash=...&port=...&compact=1
```

The `compact` parameter is **advisory**:
- Trackers MAY return either format regardless of the parameter
- Clients MUST support both formats

### Tracker Response

The `peers` key in the tracker response:
- Original format: bencoded list of dictionaries
- Compact format: bencoded string (6 bytes per peer)

### Example Compact Response

```
d8:intervali1800e6:peers12:...binary data...e
```

Where `...binary data...` is 12 bytes representing 2 peers.

---

## Compact Peer Format

```
+--------+--------+--------+--------+--------+--------+
| IP byte 1 | IP byte 2 | IP byte 3 | IP byte 4 | Port high | Port low |
+--------+--------+--------+--------+--------+--------+
```

- All values are in network byte order (big endian)
- Port: `port = (port_high << 8) | port_low`
- IP: Standard dotted notation

### Example

Peer at `192.168.1.1:6881`:
```
Bytes: 0xC0 0xA8 0x01 0x01 0x1A 0xE1
```

---

## Implementation Notes

1. The `peer_id` is not present in compact format
2. This has not posed problems in practice
3. Most modern clients and trackers support this format
4. It is RECOMMENDED that trackers return compact format by default

---

## References

- Specification: https://www.bittorrent.org/beps/bep_0023.html
