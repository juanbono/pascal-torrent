# BEP 15: UDP Tracker Protocol for BitTorrent

**BEP:** 15  
**Title:** UDP Tracker Protocol for BitTorrent  
**Version:** 023256c7581a4bed356e47caf8632be2834211bd  
**Last-Modified:** Thu Jan 12 12:29:12 2017 -0800  
**Author:** Olaf van der Spek <olafvdspek@gmail.com>  
**Status:** Accepted  
**Type:** Standards Track  
**Created:** 13-Feb-2008

---

## Abstract

A UDP-based tracker protocol to reduce overhead and improve performance compared to HTTP trackers.

---

## Benefits

| Protocol | Packets | Bytes (50 peers) |
|----------|---------|------------------|
| HTTP | ~10 | ~1206 |
| UDP | 4 | ~618 |

**50% traffic reduction**

---

## Connection Establishment

UDP is connectionless and spoofable. To prevent spoofing, a connection ID mechanism is used:

1. Client sends connect request
2. Tracker responds with connection ID
3. Client uses connection ID for subsequent requests
4. Connection ID expires after 60 seconds

---

## Timeout and Retry

UDP is unreliable. The client must handle retransmission:

- Initial timeout: 15 seconds
- Each retry: `timeout = 15 * 2^n` seconds
- Maximum `n`: 8 (3840 seconds)
- Must request new connection ID when expired

---

## Packet Formats

All values are in **network byte order (big endian)**.

### Connect Request

| Offset | Size | Name | Value |
|--------|------|------|-------|
| 0 | 64-bit | protocol_id | 0x41727101980 (magic constant) |
| 8 | 32-bit | action | 0 (connect) |
| 12 | 32-bit | transaction_id | random |

### Connect Response

| Offset | Size | Name | Value |
|--------|------|------|-------|
| 0 | 32-bit | action | 0 (connect) |
| 4 | 32-bit | transaction_id | echoed |
| 8 | 64-bit | connection_id | generated |

### Announce Request (IPv4)

| Offset | Size | Name | Description |
|--------|------|------|-------------|
| 0 | 64-bit | connection_id | From connect response |
| 8 | 32-bit | action | 1 (announce) |
| 12 | 32-bit | transaction_id | random |
| 16 | 20 bytes | info_hash | |
| 36 | 20 bytes | peer_id | |
| 56 | 64-bit | downloaded | |
| 64 | 64-bit | left | |
| 72 | 64-bit | uploaded | |
| 80 | 32-bit | event | 0=none, 1=completed, 2=started, 3=stopped |
| 84 | 32-bit | ip | 0 = default |
| 88 | 32-bit | key | random |
| 92 | 32-bit | num_want | -1 = default |
| 96 | 16-bit | port | |

### Announce Response (IPv4)

| Offset | Size | Name | Description |
|--------|------|------|-------------|
| 0 | 32-bit | action | 1 (announce) |
| 4 | 32-bit | transaction_id | echoed |
| 8 | 32-bit | interval | |
| 12 | 32-bit | leechers | |
| 16 | 32-bit | seeders | |
| 20 | 6*n bytes | peers | Compact peer info |

### Scrape Request

| Offset | Size | Name | Description |
|--------|------|------|-------------|
| 0 | 64-bit | connection_id | |
| 8 | 32-bit | action | 2 (scrape) |
| 12 | 32-bit | transaction_id | |
| 16 | 20*n bytes | info_hash | Multiple allowed |

### Scrape Response

| Offset | Size | Name | Description |
|--------|------|------|-------------|
| 0 | 32-bit | action | 2 (scrape) |
| 4 | 32-bit | transaction_id | |
| 8 | | | Repeating: |
| | 32-bit | seeders | |
| | 32-bit | completed | |
| | 32-bit | leechers | |

### Error Response

| Offset | Size | Name | Description |
|--------|------|------|-------------|
| 0 | 32-bit | action | 3 (error) |
| 4 | 32-bit | transaction_id | echoed |
| 8 | string | error_string | error message |

---

## IPv6 Support

IPv6 announces have the same structure except:
- Peers in response use 18 bytes (16 for IPv6 + 2 for port)
- The `IP` field in request remains 32-bit (should be set to 0)

Format determined by UDP packet's address family.

---

## References

- Specification: https://www.bittorrent.org/beps/bep_0015.html
